<!doctype html>
<html>
<head>
    <title>GEcon</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        header {
            font-size: 100pt;
            text-align: center;
            vertical-align: middle;
            margin-top: 10%;
        }

        form {
            background: #000;
            padding: 3px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        form input {
            border: 0;
            padding: 10px;
            width: 70%;
            margin-right: .5%;
        }

        form button {
            width: 9%;
            background: rgb(130, 224, 255);
            border: none;
            padding: 10px;
        }

        #messages {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        #messages li {
            padding: 5px 10px;
        }

        #messages li:nth-child(odd) {
            background: #eee;
        }
    </style>
</head>
<body>
<div id="data">no data</div>
<div id="panel">
    <form action="">
        <input id="m" autocomplete="off" type="number"/>
        <button id="plus">+</button>
        <button id="minus">-</button>
        <button id="send">Send</button>
    </form>
    <select id="userslist">
    </select>
</div>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>
    var user = window.prompt("Enter your name:", "");
    document.title = 'GEcon: ' + user;

    $(function () {
        var socket = io();
        socket.emit('user joined', {user: user===''?'no-name':user});

        socket.on('output', function (data) {
            if (data.length) {
                for (var i = 0; i < data.length; i++) {
                    if(data[i].user!==user){ $('#userslist').append($('<option>', {value: data[i].user, text: data[i].user}));}
                }
            }
        });
        socket.on('update: '+user, function (data) {
            console.log("update poszed≈Ç");
            $('#data').text(data.balance+'k');
        });

        $('#plus').on('click', function () {
            socket.emit('balance change', {user: user, change: parseInt($('#m').val()), if_add: true});
            console.log("plus clicked");
            //$('#m').val('');
            return false;
        });
        $('#minus').on('click', function () {
            socket.emit('balance change', {user: user, change: parseInt($('#m').val()), if_add: false});

            console.log("minus clicked");
            //$('#m').val('');
            return false;
        });
        $('#send').on('click', function () {
            socket.emit('transfer', {user_minus: user, user_plus: $('#userslist').find(":selected").text(), change: parseInt($('#m').val())});
            console.log("transfer clicked");
            //$('#m').val('');
            return false;
        });
    });
</script>
</body>
</html>